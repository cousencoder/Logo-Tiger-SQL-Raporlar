SELECT 
[Stok Kodu],
[Stok Adı],
sum(CASE WHEN Ay=1 and MIKTAR>0 THEN MIKTAR ELSE 0 END) [Ocak Satış],
sum(CASE WHEN Ay=1 and MIKTAR<0 THEN MIKTAR ELSE 0 END) [Ocak İade],
sum(CASE WHEN Ay=1 THEN MIKTAR ELSE 0 END) [Ocak Net]
FROM (
SELECT 
KART.CODE [Stok Kodu],
KART.NAME [Stok Adı],
MONTH(STL.DATE_) AS [Ay],
ISNULL(CAST(SUM(CASE WHEN STL.TRCODE IN(7,8) THEN 1 ELSE -1 END * (STL.AMOUNT*ITU.CONVFACT2)) AS numeric(38,2)),0) [Mıktar]
FROM LG_025_01_STLINE STL LEFT OUTER JOIN LG_025_UNITSETL ITU ON ITU.LOGICALREF=STL.UOMREF
LEFT OUTER JOIN LG_025_ITEMS KART ON KART.LOGICALREF=STL.STOCKREF
WHERE TRCODE IN (7,8,2,3) AND STL.LINETYPE=0
GROUP BY MONTH(STL.DATE_),KART.CODE,KART.NAME)LOGO_DESTEK
GROUP BY
[Stok Kodu],
[Stok Adı]
ORDER BY 
[Stok Kodu],
[Stok Adı]
